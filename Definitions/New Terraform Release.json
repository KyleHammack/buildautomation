{"source":2,"revision":33,"description":null,"createdBy":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"createdOn":"2018-10-04T07:40:25.643Z","modifiedBy":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"modifiedOn":"2019-02-13T21:57:09.720Z","isDeleted":false,"variables":{"adminPassword":{"value":null,"isSecret":true},"client_id":{"value":"7c78280d-3bb9-47e9-b84d-dae1508efa6c"},"client_secret":{"value":null,"isSecret":true},"coreTicket":{"value":"123456-12345"},"sqladminPassword":{"value":null,"isSecret":true},"sslPassword":{"value":null,"isSecret":true},"subscription_id":{"value":"b038302d-307d-4dcf-8684-89839b20b338"},"templatearchive":{"value":"kyleterrtesttemplates"},"tenant_id":{"value":"200af68a-d0e0-4c9c-acba-ee8d1737d217"}},"variableGroups":[],"environments":[{"id":1048,"name":"Terraform Deploy from Build File","rank":1,"owner":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3143}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":3148},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3149}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"alias":"rsazure-internal-terraform","artifactType":"Git","artifactDownloadMode":"All"}]},"queueId":56,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","refName":null,"workflowTasks":[{"environment":{},"taskId":"5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c","version":"2.*","name":"Copy Build File to: $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"SourceFolder":"$(System.ArtifactsDirectory)\\Build\\drop_artifact_$(build.buildNumber)","Contents":"build.json","TargetFolder":"$(System.DefaultWorkingDirectory)","CleanTargetFolder":"false","OverWrite":"false","flattenFolders":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Generate Terraform from Build File","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"filePath","filePath":"$(System.DefaultWorkingDirectory)/rsazure-internal-terraform/BuildAutomation/GenerateTerraform.ps1","arguments":"-buildfile $(System.DefaultWorkingDirectory)/build.json -templatesdirpath \"$(System.DefaultWorkingDirectory)/rsazure-internal-terraform/BuildAutomation/Templates\" -outputdirpath $(System.DefaultWorkingDirectory)","script":"# Write your powershell commands here.\n\nWrite-Host \"Hello World\"\n\n# Use the environment variables input below to pass secret variables to this script.","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform init -input=false","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform apply -input=false -auto-approve -var tenant_id=$(tenant_id) -var subscription_id=$(subscription_id) -var client_id=$(client_id) -var client_secret=$(client_secret) -var adminPassword=$(adminPassword) -var sqladminPassword=$(sqladminPassword) -var sslPassword=$(sslPassword)","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Zip Terraform State Files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"c:\\windows\\system32\\7z\\7za.exe a -tzip State-Files-$(coreTicket).zip \"$(System.DefaultWorkingDirectory)/.terraform\" \"$(System.DefaultWorkingDirectory)/terraform.tfstate\"","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Create Archive Storage Account","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","ScriptType":"InlineScript","ScriptPath":"","Inline":"$vaults = Get-AzureRmRecoveryServicesVault\n$vault = $vaults | Select -First 1\nNew-AzureRmStorageAccount -ResourceGroupName $vault.ResourceGroupName -Location $vault.Location -Name $(templatearchive) -SkuName Standard_LRS","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"1.*","name":"Copy State Files to Archive Storage Account","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)\\State-Files-$(coreTicket).zip","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(templatearchive)","ContainerName":"tfstate","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArguments":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"1.*","name":"Copy Templates to Archive Storage Account","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)\\main.tf.json","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(templatearchive)","ContainerName":"archive","BlobPrefix":"$(coreTicket)","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArguments":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"b7e8b412-0437-4065-9371-edc5881de25b","version":"1.*","name":"Delete files from $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"always()","inputs":{"SourceFolder":"$(System.DefaultWorkingDirectory)","Contents":"**\\*"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":3232,"url":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/releases/3232","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://rseng.vsrm.visualstudio.com/_apis/public/Release/badge/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/165/1048"},{"id":1049,"name":"Terraform Redeploy","rank":2,"owner":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3144}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":3147},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3150}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"alias":"rsazure-builddocument","artifactType":"Git","artifactDownloadMode":"All"},{"alias":"rsazure-internal-terraform","artifactType":"Git","artifactDownloadMode":"All"}]},"queueId":56,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","refName":null,"workflowTasks":[{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Download Archived Terraform State Files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","ScriptType":"InlineScript","ScriptPath":"","Inline":"$stors = Get-AzureRmStorageAccount\n$sa = $stors | where{$_.StorageAccountName -like \"$(templatearchive)\"}\n\nGet-AzureStorageBlobContent -Blob \"State-Files-$(coreTicket).zip\" -Container \"tfstate\" -context $sa.Context -Destination $(System.DefaultWorkingDirectory)","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"Extract Terraform State files to working directory","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"archiveFilePatterns":"$(System.DefaultWorkingDirectory)\\State-Files-$(coreTicket).zip","destinationFolder":"$(System.DefaultWorkingDirectory)","cleanDestinationFolder":"false"}},{"environment":{},"taskId":"5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c","version":"2.*","name":"Copy Build File to: $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"SourceFolder":"$(System.ArtifactsDirectory)\\Build\\drop_artifact_$(build.buildNumber)","Contents":"build.json","TargetFolder":"$(System.DefaultWorkingDirectory)","CleanTargetFolder":"false","OverWrite":"false","flattenFolders":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Generate Terraform from Build File","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"filePath","filePath":"$(System.DefaultWorkingDirectory)/rsazure-internal-terraform/BuildAutomation/GenerateTerraform.ps1","arguments":"-buildfile $(System.DefaultWorkingDirectory)/build.json -templatesdirpath \"$(System.DefaultWorkingDirectory)/rsazure-internal-terraform/BuildAutomation/Templates\" -outputdirpath $(System.DefaultWorkingDirectory)","script":"# Write your powershell commands here.\n\nWrite-Host \"Hello World\"\n\n# Use the environment variables input below to pass secret variables to this script.","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform init -input=false","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform apply -input=false -auto-approve -var tenant_id=$(tenant_id) -var subscription_id=$(subscription_id) -var client_id=$(client_id) -var client_secret=$(client_secret) -var adminPassword=$(adminPassword) -var sqladminPassword=$(sqladminPassword) -var sslPassword=$(sslPassword)","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Zip Terraform State Files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"c:\\windows\\system32\\7z\\7za.exe u -tzip State-Files-$(coreTicket).zip \"$(System.DefaultWorkingDirectory)/.terraform\" \"$(System.DefaultWorkingDirectory)/terraform.tfstate\" -y","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"1.*","name":"Copy State Files to Archive Storage Account","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeededOrFailed()","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)\\State-Files-$(coreTicket).zip","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(templatearchive)","ContainerName":"tfstate","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArguments":"/Y","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"1.*","name":"Copy Templates to Archive Storage Account","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)\\main.tf.json","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(templatearchive)","ContainerName":"archive","BlobPrefix":"$(coreTicket)","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArguments":"/Y","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"b7e8b412-0437-4065-9371-edc5881de25b","version":"1.*","name":"Delete files from $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"always()","inputs":{"SourceFolder":"$(System.DefaultWorkingDirectory)","Contents":"**\\*"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":3232,"url":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/releases/3232","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://rseng.vsrm.visualstudio.com/_apis/public/Release/badge/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/165/1049"},{"id":1050,"name":"Delete State","rank":3,"owner":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3145}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":3146},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3151}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"alias":"rsazure-builddocument","artifactType":"Git","artifactDownloadMode":"All"},{"alias":"rsazure-internal-terraform","artifactType":"Git","artifactDownloadMode":"All"}]},"queueId":56,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","refName":null,"workflowTasks":[{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Delete State Container","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","ScriptType":"InlineScript","ScriptPath":"","Inline":"$stors = Get-AzureRmStorageAccount\n$sa = $stors | where{$_.StorageAccountName -like \"$(templatearchive)\"}\n\nRemove-AzureStorageContainer -Name \"tfstate\" -context $sa.Context -Force","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":0,"url":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/releases/0","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://rseng.vsrm.visualstudio.com/_apis/public/Release/badge/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/165/1050"},{"id":1686,"name":"QC","rank":4,"owner":{"displayName":"Kyle Hammack","url":"https://app.vssps.visualstudio.com/Aec9c91ba-48ee-40a9-85e5-e2b6c75ee6c4/_apis/Identities/23b39611-ee82-6b51-9fd6-3cc617f384f8","_links":{"avatar":{"href":"https://rseng.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"}},"id":"23b39611-ee82-6b51-9fd6-3cc617f384f8","uniqueName":"Kyle.Hammack@rackspace.com","imageUrl":"https://rseng.visualstudio.com/_api/_common/identityImage?id=23b39611-ee82-6b51-9fd6-3cc617f384f8","descriptor":"aad.MjNiMzk2MTEtZWU4Mi03YjUxLTlmZDYtM2NjNjE3ZjM4NGY4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":5057}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":5058},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":5059}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"alias":"rsazure-builddocument","artifactType":"Git","artifactDownloadMode":"All"},{"alias":"rsazure-internal-terraform","artifactType":"Git","artifactDownloadMode":"All"}]},"queueId":56,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c","version":"2.*","name":"Copy Files to: $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"SourceFolder":"$(System.ArtifactsDirectory)\\Build\\drop_artifact_$(build.buildNumber)","Contents":"build.json","TargetFolder":"$(System.DefaultWorkingDirectory)","CleanTargetFolder":"false","OverWrite":"false","flattenFolders":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Azure PowerShell script: InlineScript","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"b837e3e8-cfa7-4d12-bbc8-53e9baab5480","ScriptType":"InlineScript","ScriptPath":"$(System.DefaultWorkingDirectory)/rsazure-builddocument/TestSuite/Start-TfQC.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments\nUpdate-Module -Name Pester -Force\nImport-Module $(System.DefaultWorkingDirectory)/rsazure-builddocument/BuildDocument.psm1 -force\n\nInvoke-Pester -Script @{Path=$(Join-Path \"$(System.DefaultWorkingDirectory)/rsazure-internal-buildtests\" \"Start-BuildQc.ps1\");Parameters=@{BuildPath='$(System.DefaultWorkingDirectory)/build.json'}} -PassThru -OutputFile $(Join-Path \"$(System.DefaultWorkingDirectory)/\" \"QC.TestResults.xml\") -OutputFormat NUnitXml -ErrorAction SilentlyContinue","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"0b0f01ed-7dde-43ff-9cbb-e48954daf9b1","version":"2.*","name":"Publish Test Results **/QC.TestResults.xml","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"testRunner":"NUnit","testResultsFiles":"**/QC.TestResults.xml","searchFolder":"$(System.DefaultWorkingDirectory)","mergeTestResults":"true","failTaskOnFailedTests":"false","testRunTitle":"QC","platform":"","configuration":"","publishRunAttachments":"true"}},{"environment":{},"taskId":"b7e8b412-0437-4065-9371-edc5881de25b","version":"1.*","name":"Delete files from $(System.DefaultWorkingDirectory)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"always()","inputs":{"SourceFolder":"$(System.DefaultWorkingDirectory)","Contents":"**/**"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":3232,"url":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/releases/3232","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://rseng.vsrm.visualstudio.com/_apis/public/Release/badge/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/165/1686"}],"artifacts":[{"sourceId":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c:8dc41dfe-40b6-4958-8115-27284308f40e","type":"Git","alias":"rsazure-builddocument","definitionReference":{"branches":{"id":"master","name":"master"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"8dc41dfe-40b6-4958-8115-27284308f40e","name":"rsazure-builddocument"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c","name":"Internal"}},"isRetained":false},{"sourceId":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c:5d8b72b0-c487-4137-9f4e-0237befe7545","type":"Git","alias":"rsazure-internal-buildtests","definitionReference":{"branches":{"id":"master","name":"master"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"5d8b72b0-c487-4137-9f4e-0237befe7545","name":"rsazure-internal-buildtests"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c","name":"Internal"}},"isRetained":false},{"sourceId":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c:6b436aab-4abe-419f-b202-bb72dfa5df1d","type":"Git","alias":"rsazure-internal-terraform","definitionReference":{"branches":{"id":"buildautomation","name":"buildautomation"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"6b436aab-4abe-419f-b202-bb72dfa5df1d","name":"rsazure-internal-terraform"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"d22dbab9-f748-49ef-82bf-8b4ea8f2932c","name":"Internal"}},"isRetained":false}],"triggers":[{"artifactAlias":"Build","triggerConditions":[],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"pipelineProcess":{"type":1},"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"Other"}},"id":165,"name":"New Terraform Release","path":"\\TerraformTest","projectReference":null,"url":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/definitions/165","_links":{"self":{"href":"https://rseng.vsrm.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_apis/Release/definitions/165"},"web":{"href":"https://rseng.visualstudio.com/d22dbab9-f748-49ef-82bf-8b4ea8f2932c/_release?definitionId=165"}}}